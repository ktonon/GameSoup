{% extends "admin/change_form_custom.html" %}
{% load library %}


{% block extra-object-tools %} 
<li><a href="{% url library:generate_type_code object_id %}">Generate Code</a></li>
{% endblock extra-object-tools %}


{% block after_field_sets %}
<br/><hr/><br/>
{% get_type for object_id as type %}
{% if type %}
    {% with type.implements.all as interfaces %}
    {% if interfaces %}
    <table class="module" style="width: 100%">
        <caption>Implemented interfaces</caption>
        <thead>
            <tr>
                <th>Strongest expression</th>
            </tr>
        </thead>
        <tbody>
            {% for interface in interfaces %}
            <tr class="{% cycle row1,row2 %}">
                {% get_strongest_expression_for_interface interface of type as expr %}
                <td><pre>{{ expr.render_with_links|safe }}</pre></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% endwith %}    
    {% methods_for_type type as methods %}
    {% if methods %}    
    <table class="module" style="width: 100%">
        <caption>Methods</caption>
        <thead>
            <tr>
                <th>Signature</th>
                <th>From interface</th>
            </tr>
        </thead>
        <tbody>
            {% for method in methods %}
            <tr class="{% cycle row1,row2 %}">
                <td><pre><a href="{% url admin:library_method_change method.id %}">{% method_signature_for_type type method "escaped" %}</a></pre></td>
                <td><a href="{% url admin:library_interface_change method.interface.id %}">{{ method.interface.name }}</a></td>
            </tr> 
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% with type.parameters.all as parameters %}
    {% if parameters %}
    <table class="module" style="width: 100%">
        <caption>Type parameters</caption>
        <thead>
            <tr>
                <th>Parameter name</th>
                <th>Strongest expression</th>
            </tr>
        </thead>
        <tbody>
            {% for param in parameters %}
            <tr class="{% cycle row1,row2 %}">
                <td>{{ param.name }}</td>
                <td><pre>{{ param.strongest_expression.render_with_links|safe }}</pre></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% endwith %}
{% endif %}
<br/><hr/><br/>
{% endblock after_field_sets %}


{% block after_related_objects %}
<br/><hr/><br/>
{% get_type for object_id as type %}
{% if type %}
    {% with type.instances.all as objects %}
    {% if objects %}
    <table class="module" style="width: 100%">
        <caption>Objects which are instances of {{ type.name }}</caption>
        <thead>
            <tr>
                <th>Object name</th>
                <th>From game</th>
                <th>Expression</th>
            </tr>
        </thead>
        <tbody>
            {% for obj in objects %}
            <tr class="{% cycle row1,row2 %}">
                <td><a href="{% url admin:games_object_change obj.id %}">{{ obj.name }}</a></td>
                <td><a href="{% url admin:games_game_change obj.game.id %}">{{ obj.game.name }}</a></td>
                <td>
                    {% get_strongest_expression_for_type type of obj as expr %}
                    <pre>{{ expr.render_with_links|safe }}</pre>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% endwith %}
{% endif %}
{% endblock after_related_objects %}